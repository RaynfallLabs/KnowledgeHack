<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Philosopher's Quest - Knowledge is Power</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="screen active">
        <div class="welcome-content">
            <h1 class="game-title">PHILOSOPHER'S QUEST</h1>
            <p class="game-subtitle">Knowledge is Literally Power</p>
            <div class="welcome-form">
                <input type="text" id="player-name-input" placeholder="Enter your name, seeker..." maxlength="20">
                <button id="start-game-btn">Begin Your Quest</button>
            </div>
            <div class="welcome-info">
                <p>Every action requires knowledge.</p>
                <p>Every swing of your sword demands mathematics.</p>
                <p>Every piece of armor requires geography.</p>
                <p>Learn or perish in the depths.</p>
            </div>
        </div>
    </div>

    <!-- Main Game Screen -->
    <div id="game-screen" class="screen">
        <div id="game-container">
            <div id="main-area">
                <div id="game-display"></div>
                <div id="message-log"></div>
            </div>
            <div id="sidebar">
                <!-- Player Stats -->
                <div class="stat-group">
                    <h3>VITALS</h3>
                    <div class="stat-bar">
                        <div class="stat-bar-fill hp-bar" id="hp-bar"></div>
                        <div class="stat-bar-text" id="hp-text">HP: 20/20</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-bar-fill sp-bar" id="sp-bar"></div>
                        <div class="stat-bar-text" id="sp-text">SP: 100/100</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-bar-fill mp-bar" id="mp-bar"></div>
                        <div class="stat-bar-text" id="mp-text">MP: 10/10</div>
                    </div>
                </div>
                
                <!-- Attributes -->
                <div class="stat-group">
                    <h3>ATTRIBUTES</h3>
                    <div>STR: <span id="str">10</span> | CON: <span id="con">10</span></div>
                    <div>DEX: <span id="dex">10</span> | INT: <span id="int">10</span></div>
                    <div>WIS: <span id="wis">10</span> | PER: <span id="per">10</span></div>
                </div>
                
                <!-- Status -->
                <div class="stat-group">
                    <h3>STATUS</h3>
                    <div>AC: <span id="ac">10</span> | Level: <span id="dungeon-level">1</span></div>
                    <div>Sight: <span id="sight">5</span> | Timer: <span id="timer">10</span>s</div>
                    <div id="hunger-status"></div>
                    <div id="burden-status"></div>
                    <div id="status-effects"></div>
                </div>

                <!-- Equipment -->
                <div class="stat-group">
                    <h3>EQUIPMENT</h3>
                    <div id="equipment-list">
                        <div class="inventory-item">Nothing equipped</div>
                    </div>
                </div>

                <!-- Inventory -->
                <div class="stat-group">
                    <h3>INVENTORY (<span id="weight">0/50</span>)</h3>
                    <div id="inventory-list">
                        <div class="inventory-item">Empty</div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls">
                    <h4>CONTROLS</h4>
                    <div class="control-line"><span class="key">↑↓←→/HJKL</span> Move</div>
                    <div class="control-line"><span class="key">,/g</span> Get item</div>
                    <div class="control-line"><span class="key">E</span> Eat food</div>
                    <div class="control-line"><span class="key">c</span> Cook</div>
                    <div class="control-line"><span class="key">I</span> Identify</div>
                    <div class="control-line"><span class="key">./Space</span> Wait</div>
                    <div class="control-line"><span class="key">?</span> Help</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <div class="quiz-header">
                <div class="quiz-title" id="quiz-title">Knowledge Challenge</div>
                <div id="quiz-subject">Mathematics</div>
                <div class="quiz-timer" id="quiz-timer">30</div>
                <div class="quiz-progress" id="quiz-progress">Question 1 | Score: 0</div>
            </div>
            <div class="quiz-question" id="quiz-question">Question will appear here</div>
            <div id="quiz-input-area">
                <input type="text" class="quiz-input" id="quiz-answer" placeholder="Type your answer..." autocomplete="off">
                <button class="quiz-button" id="quiz-submit">Submit Answer</button>
            </div>
            <div class="quiz-feedback" id="quiz-feedback" style="display: none;"></div>
        </div>
    </div>

    <script>
        // ===== PHILOSOPHER'S QUEST - COMPLETE GAME =====
        
        // Global game state
        const Game = {
            // Core state
            player: null,
            dungeon: null,
            monsters: [],
            items: [],
            currentLevel: 1,
            turn: 0,
            
            // Display
            display: null,
            messageLog: [],
            maxMessages: 100,
            
            // Quiz state
            activeQuiz: null,
            quizTimer: null,
            quizTimeRemaining: 0,
            
            // Game configuration
            config: {
                mapWidth: 80,
                mapHeight: 25,
                baseHP: 20,
                baseSP: 100,
                baseMP: 10,
                startingWisdom: 10
            }
        };

        // ===== PLAYER CLASS =====
        class Player {
            constructor(name = "Hero") {
                this.name = name;
                
                // Core attributes
                this.strength = 10;
                this.constitution = 10;
                this.dexterity = 10;
                this.intelligence = 10;
                this.wisdom = 10;
                this.perception = 10;
                
                // Derived stats
                this.maxHp = Game.config.baseHP + Math.floor((this.constitution - 10) / 2);
                this.hp = this.maxHp;
                this.maxSp = Game.config.baseSP + (this.constitution - 10) * 2;
                this.sp = this.maxSp;
                this.maxMp = Game.config.baseMP + Math.floor((this.intelligence - 10) / 2);
                this.mp = this.maxMp;
                
                // Position
                this.x = 0;
                this.y = 0;
                
                // Equipment slots
                this.equipped = {
                    weapon: null,
                    armor: {
                        head: null,
                        body: null,
                        hands: null,
                        legs: null,
                        cloak: null,
                        shirt: null
                    },
                    accessories: {
                        leftRing: null,
                        rightRing: null,
                        amulet: null
                    }
                };
                
                // Inventory
                this.inventory = [];
                this.maxCarry = 50 + this.strength * 2;
                this.currentWeight = 0;
                
                // Status flags
                this.statusFlags = {
                    isStarving: false,
                    isConfused: false,
                    isBlind: false,
                    isStunned: false,
                    isHallucinating: false,
                    isParalyzed: false,
                    isSick: false,
                    isPoisoned: false,
                    isStoned: false,
                    isSlimed: false,
                    isLevitating: false,
                    isFlying: false,
                    isInvisible: false
                };
                
                // Inventory letter assignment
                this.nextInventoryLetter = 'a';
            }
            
            getAC() {
                let ac = 10 + Math.floor((this.dexterity - 10) / 2);
                Object.values(this.equipped.armor).forEach(armor => {
                    if (armor) ac += armor.acBonus || 0;
                });
                return ac;
            }
            
            getSightRadius() {
                return 3 + Math.floor(this.perception / 5);
            }
            
            getQuizTimer() {
                return Math.max(10, this.wisdom);
            }
            
            getHungerStatus() {
                const percent = this.sp / this.maxSp;
                if (this.sp <= 0) return "Starving";
                if (percent <= 0.1) return "Fainting";
                if (percent <= 0.2) return "Weak";
                if (percent <= 0.3) return "Hungry";
                if (percent >= 1.2) return "Satiated";
                return "";
            }
            
            getBurdenStatus() {
                const percent = (this.currentWeight / this.maxCarry) * 100;
                if (percent > 300) return "Overloaded";
                if (percent > 200) return "Overtaxed";
                if (percent > 150) return "Strained";
                if (percent > 100) return "Stressed";
                if (percent > 75) return "Burdened";
                return "";
            }
            
            takeDamage(amount) {
                this.hp -= amount;
                if (this.hp <= 0) {
                    this.hp = 0;
                    Game.gameOver("You have died!");
                }
            }
            
            spendSP(amount = 1) {
                this.sp -= amount;
                if (this.sp <= 0) {
                    this.sp = 0;
                    this.statusFlags.isStarving = true;
                    this.takeDamage(1);
                    Game.addMessage("You're starving! You take damage!", 'danger');
                } else {
                    this.statusFlags.isStarving = false;
                }
            }
            
            restoreSP(amount) {
                this.sp = Math.min(this.maxSp, this.sp + amount);
                if (this.sp > 0) this.statusFlags.isStarving = false;
            }
            
            addToInventory(item) {
                if (this.currentWeight + (item.weight || 1) > this.maxCarry) {
                    Game.addMessage("You can't carry that much weight!", 'warning');
                    return false;
                }
                
                // Assign inventory letter
                item.letter = this.nextInventoryLetter;
                this.nextInventoryLetter = String.fromCharCode(this.nextInventoryLetter.charCodeAt(0) + 1);
                if (this.nextInventoryLetter > 'z') this.nextInventoryLetter = 'A';
                
                this.inventory.push(item);
                this.currentWeight += item.weight || 1;
                return true;
            }
            
            removeFromInventory(item) {
                const index = this.inventory.indexOf(item);
                if (index > -1) {
                    this.inventory.splice(index, 1);
                    this.currentWeight -= item.weight || 1;
                    return true;
                }
                return false;
            }
        }

        // ===== MONSTER CLASS =====
        class Monster {
            constructor(type, x, y) {
                this.type = type;
                this.x = x;
                this.y = y;
                
                // Default stats for basic monsters
                const monsterTypes = {
                    'goblin': { symbol: 'g', hp: 5, damage: 2, color: '#8b8' },
                    'orc': { symbol: 'o', hp: 10, damage: 3, color: '#a82' },
                    'skeleton': { symbol: 's', hp: 8, damage: 2, color: '#ddd' },
                    'rat': { symbol: 'r', hp: 3, damage: 1, color: '#888' },
                    'kobold': { symbol: 'k', hp: 4, damage: 2, color: '#88f' }
                };
                
                const data = monsterTypes[type] || monsterTypes['goblin'];
                this.name = type;
                this.symbol = data.symbol;
                this.color = data.color;
                this.maxHp = data.hp;
                this.hp = this.maxHp;
                this.damage = data.damage;
                this.dead = false;
            }
            
            takeDamage(amount) {
                this.hp -= amount;
                if (this.hp <= 0) {
                    this.hp = 0;
                    this.dead = true;
                }
            }
            
            move() {
                if (this.dead) return;
                
                // Simple AI: move toward player if within 10 tiles
                const dx = Game.player.x - this.x;
                const dy = Game.player.y - this.y;
                const distance = Math.abs(dx) + Math.abs(dy);
                
                if (distance > 10) return; // Too far, don't chase
                
                let moveX = 0, moveY = 0;
                
                if (Math.abs(dx) > Math.abs(dy)) {
                    moveX = dx > 0 ? 1 : -1;
                } else if (dy !== 0) {
                    moveY = dy > 0 ? 1 : -1;
                }
                
                const newX = this.x + moveX;
                const newY = this.y + moveY;
                
                // Check if attacking player
                if (newX === Game.player.x && newY === Game.player.y) {
                    this.attack();
                } else if (Game.canMoveTo(newX, newY) && !Game.getMonsterAt(newX, newY)) {
                    this.x = newX;
                    this.y = newY;
                }
            }
            
            attack() {
                Game.player.takeDamage(this.damage);
                Game.addMessage(`The ${this.name} hits you for ${this.damage} damage!`, 'danger');
            }
        }

        // ===== DUNGEON GENERATION =====
        function generateDungeon(width, height) {
            const dungeon = [];
            
            // Initialize with walls
            for (let y = 0; y < height; y++) {
                dungeon[y] = [];
                for (let x = 0; x < width; x++) {
                    dungeon[y][x] = '#';
                }
            }
            
            // Generate rooms
            const rooms = [];
            const numRooms = 5 + Math.floor(Math.random() * 5);
            
            for (let i = 0; i < numRooms; i++) {
                const roomWidth = 5 + Math.floor(Math.random() * 10);
                const roomHeight = 5 + Math.floor(Math.random() * 6);
                const roomX = 1 + Math.floor(Math.random() * (width - roomWidth - 2));
                const roomY = 1 + Math.floor(Math.random() * (height - roomHeight - 2));
                
                // Carve room
                for (let y = roomY; y < roomY + roomHeight; y++) {
                    for (let x = roomX; x < roomX + roomWidth; x++) {
                        dungeon[y][x] = '.';
                    }
                }
                
                rooms.push({
                    x: roomX + Math.floor(roomWidth / 2),
                    y: roomY + Math.floor(roomHeight / 2),
                    width: roomWidth,
                    height: roomHeight
                });
            }
            
            // Connect rooms with corridors
            for (let i = 0; i < rooms.length - 1; i++) {
                const room1 = rooms[i];
                const room2 = rooms[i + 1];
                
                // Horizontal then vertical
                const startX = Math.min(room1.x, room2.x);
                const endX = Math.max(room1.x, room2.x);
                for (let x = startX; x <= endX; x++) {
                    dungeon[room1.y][x] = '.';
                }
                
                const startY = Math.min(room1.y, room2.y);
                const endY = Math.max(room1.y, room2.y);
                for (let y = startY; y <= endY; y++) {
                    dungeon[y][room2.x] = '.';
                }
            }
            
            // Place player in first room
            if (rooms.length > 0) {
                Game.player.x = rooms[0].x;
                Game.player.y = rooms[0].y;
            }
            
            // Place stairs in last room
            if (rooms.length > 1) {
                const lastRoom = rooms[rooms.length - 1];
                dungeon[lastRoom.y][lastRoom.x] = '>';
            }
            
            // Spawn monsters
            Game.monsters = [];
            const monsterTypes = ['goblin', 'rat', 'kobold', 'orc', 'skeleton'];
            const numMonsters = 3 + Math.floor(Math.random() * 5);
            
            for (let i = 0; i < numMonsters && i < rooms.length - 1; i++) {
                const room = rooms[1 + i]; // Skip first room (player spawn)
                const type = monsterTypes[Math.floor(Math.random() * monsterTypes.length)];
                const x = room.x - 2 + Math.floor(Math.random() * 5);
                const y = room.y - 2 + Math.floor(Math.random() * 5);
                
                if (dungeon[y][x] === '.') {
                    Game.monsters.push(new Monster(type, x, y));
                }
            }
            
            // Spawn items
            Game.items = [];
            const itemTypes = [
                { type: 'food', name: 'ration', symbol: '%', weight: 1 },
                { type: 'weapon', name: 'dagger', symbol: ')', weight: 3 },
                { type: 'armor', name: 'leather armor', symbol: '[', weight: 8 },
                { type: 'potion', name: 'healing potion', symbol: '!', weight: 1 }
            ];
            
            const numItems = 2 + Math.floor(Math.random() * 4);
            for (let i = 0; i < numItems; i++) {
                const room = rooms[Math.floor(Math.random() * rooms.length)];
                const x = room.x - 2 + Math.floor(Math.random() * 5);
                const y = room.y - 2 + Math.floor(Math.random() * 5);
                
                if (dungeon[y][x] === '.') {
                    const template = itemTypes[Math.floor(Math.random() * itemTypes.length)];
                    Game.items.push({
                        ...template,
                        x: x,
                        y: y,
                        identified: false
                    });
                }
            }
            
            return dungeon;
        }

        // ===== RENDERING =====
        function render() {
            if (!Game.display || !Game.dungeon || !Game.player) return;
            
            let display = '';
            const sightRadius = Game.player.getSightRadius();
            
            for (let y = 0; y < Game.config.mapHeight; y++) {
                for (let x = 0; x < Game.config.mapWidth; x++) {
                    // Check if in sight
                    const dx = Math.abs(x - Game.player.x);
                    const dy = Math.abs(y - Game.player.y);
                    const inSight = dx <= sightRadius && dy <= sightRadius;
                    
                    // Player
                    if (x === Game.player.x && y === Game.player.y) {
                        display += '@';
                        continue;
                    }
                    
                    // Only show things in sight
                    if (!inSight) {
                        display += ' ';
                        continue;
                    }
                    
                    // Monsters
                    let hasMonster = false;
                    for (const monster of Game.monsters) {
                        if (!monster.dead && monster.x === x && monster.y === y) {
                            display += monster.symbol;
                            hasMonster = true;
                            break;
                        }
                    }
                    if (hasMonster) continue;
                    
                    // Items
                    let hasItem = false;
                    for (const item of Game.items) {
                        if (item.x === x && item.y === y) {
                            display += item.symbol;
                            hasItem = true;
                            break;
                        }
                    }
                    if (hasItem) continue;
                    
                    // Terrain
                    if (y < Game.dungeon.length && x < Game.dungeon[y].length) {
                        display += Game.dungeon[y][x];
                    } else {
                        display += ' ';
                    }
                }
                display += '\n';
            }
            
            Game.display.textContent = display;
            updateUI();
        }

        // ===== UI UPDATES =====
        function updateUI() {
            const player = Game.player;
            if (!player) return;
            
            // Update bars
            document.getElementById('hp-bar').style.width = (player.hp / player.maxHp * 100) + '%';
            document.getElementById('hp-text').textContent = `HP: ${player.hp}/${player.maxHp}`;
            
            document.getElementById('sp-bar').style.width = (player.sp / player.maxSp * 100) + '%';
            document.getElementById('sp-text').textContent = `SP: ${player.sp}/${player.maxSp}`;
            
            document.getElementById('mp-bar').style.width = (player.mp / player.maxMp * 100) + '%';
            document.getElementById('mp-text').textContent = `MP: ${player.mp}/${player.maxMp}`;
            
            // Update attributes
            document.getElementById('str').textContent = player.strength;
            document.getElementById('con').textContent = player.constitution;
            document.getElementById('dex').textContent = player.dexterity;
            document.getElementById('int').textContent = player.intelligence;
            document.getElementById('wis').textContent = player.wisdom;
            document.getElementById('per').textContent = player.perception;
            
            // Update status
            document.getElementById('ac').textContent = player.getAC();
            document.getElementById('sight').textContent = player.getSightRadius();
            document.getElementById('timer').textContent = player.getQuizTimer();
            document.getElementById('dungeon-level').textContent = Game.currentLevel;
            
            // Hunger status
            const hungerStatus = player.getHungerStatus();
            document.getElementById('hunger-status').textContent = hungerStatus;
            
            // Burden status
            const burdenStatus = player.getBurdenStatus();
            document.getElementById('burden-status').textContent = burdenStatus;
            
            // Weight
            document.getElementById('weight').textContent = `${player.currentWeight}/${player.maxCarry}`;
            
            // Inventory
            const invList = document.getElementById('inventory-list');
            if (player.inventory.length === 0) {
                invList.innerHTML = '<div class="inventory-item">Empty</div>';
            } else {
                invList.innerHTML = player.inventory.map(item => 
                    `<div class="inventory-item">${item.letter}) ${item.name}${item.identified ? '' : ' (?)'}</div>`
                ).join('');
            }
        }

        // ===== MESSAGE LOG =====
        Game.addMessage = function(text, type = 'info') {
            const messageLog = document.getElementById('message-log');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            
            messageLog.appendChild(message);
            messageLog.scrollTop = messageLog.scrollHeight;
            
            // Limit messages
            while (messageLog.children.length > Game.maxMessages) {
                messageLog.removeChild(messageLog.firstChild);
            }
        };

        // ===== INPUT HANDLING =====
        Game.handleKeyPress = function(e) {
            // Don't handle input during quiz
            if (Game.activeQuiz) return;
            
            let dx = 0, dy = 0;
            
            // Movement keys
            switch(e.key) {
                case 'ArrowUp':
                case 'k': dy = -1; break;
                case 'ArrowDown':
                case 'j': dy = 1; break;
                case 'ArrowLeft':
                case 'h': dx = -1; break;
                case 'ArrowRight':
                case 'l': dx = 1; break;
                case 'y': dx = -1; dy = -1; break;
                case 'u': dx = 1; dy = -1; break;
                case 'b': dx = -1; dy = 1; break;
                case 'n': dx = 1; dy = 1; break;
                
                // Actions
                case ',':
                case 'g':
                    Game.pickupItem();
                    Game.processTurn();
                    return;
                case 'E':
                    Game.eatFood();
                    Game.processTurn();
                    return;
                case '.':
                case ' ':
                    Game.addMessage("You wait.", 'info');
                    Game.player.spendSP(1);
                    Game.processTurn();
                    return;
                case '>':
                    if (Game.dungeon[Game.player.y][Game.player.x] === '>') {
                        Game.nextLevel();
                    }
                    return;
                case '?':
                    Game.showHelp();
                    return;
            }
            
            // Process movement
            if (dx !== 0 || dy !== 0) {
                Game.movePlayer(dx, dy);
                e.preventDefault();
            }
        };

        Game.movePlayer = function(dx, dy) {
            const player = Game.player;
            const newX = player.x + dx;
            const newY = player.y + dy;
            
            // Check for monster
            const monster = Game.getMonsterAt(newX, newY);
            if (monster && !monster.dead) {
                Game.playerAttack(monster);
                return;
            }
            
            // Check if can move
            if (!Game.canMoveTo(newX, newY)) {
                Game.addMessage("You can't move there!", 'warning');
                return;
            }
            
            // Move player
            player.x = newX;
            player.y = newY;
            player.spendSP(1);
            
            // Check for stairs
            if (Game.dungeon[newY][newX] === '>') {
                Game.addMessage("You see stairs leading down. Press > to descend.", 'info');
            }
            
            Game.processTurn();
        };

        Game.canMoveTo = function(x, y) {
            if (y < 0 || y >= Game.dungeon.length) return false;
            if (x < 0 || x >= Game.dungeon[y].length) return false;
            return Game.dungeon[y][x] !== '#';
        };

        Game.getMonsterAt = function(x, y) {
            return Game.monsters.find(m => !m.dead && m.x === x && m.y === y);
        };

        Game.processTurn = function() {
            // Move monsters
            Game.monsters.forEach(m => m.move());
            
            // Increment turn
            Game.turn++;
            
            // Render
            render();
        };

        Game.playerAttack = function(monster) {
            // For now, simple attack without quiz
            const damage = 2 + Math.floor(Math.random() * 4);
            monster.takeDamage(damage);
            Game.addMessage(`You hit the ${monster.name} for ${damage} damage!`, 'success');
            
            if (monster.dead) {
                Game.addMessage(`The ${monster.name} dies!`, 'success');
                Game.dropCorpse(monster);
            }
            
            Game.processTurn();
        };

        Game.dropCorpse = function(monster) {
            Game.items.push({
                x: monster.x,
                y: monster.y,
                type: 'corpse',
                name: `${monster.name} corpse`,
                symbol: '%',
                weight: 10
            });
        };

        Game.pickupItem = function() {
            const player = Game.player;
            const itemsHere = Game.items.filter(i => i.x === player.x && i.y === player.y);
            
            if (itemsHere.length === 0) {
                Game.addMessage("There's nothing here to pick up.", 'info');
                return;
            }
            
            const item = itemsHere[0];
            if (player.addToInventory(item)) {
                Game.items = Game.items.filter(i => i !== item);
                Game.addMessage(`You pick up the ${item.name}.`, 'action');
            }
        };

        Game.eatFood = function() {
            const player = Game.player;
            const food = player.inventory.find(i => i.type === 'food' || i.type === 'corpse');
            
            if (!food) {
                Game.addMessage("You have no food to eat.", 'warning');
                return;
            }
            
            player.removeFromInventory(food);
            const spRestore = 20 + Math.floor(Math.random() * 20);
            player.restoreSP(spRestore);
            Game.addMessage(`You eat the ${food.name} and restore ${spRestore} SP.`, 'success');
        };

        Game.nextLevel = function() {
            Game.currentLevel++;
            Game.addMessage(`You descend to level ${Game.currentLevel}...`, 'action');
            Game.dungeon = generateDungeon(Game.config.mapWidth, Game.config.mapHeight);
            render();
        };

        Game.showHelp = function() {
            Game.addMessage("=== CONTROLS ===", 'info');
            Game.addMessage("Movement: Arrow keys or HJKLYUBN", 'info');
            Game.addMessage("Get item: , or g", 'info');
            Game.addMessage("Eat: E | Wait: . or Space", 'info');
            Game.addMessage("Descend stairs: >", 'info');
        };

        Game.gameOver = function(message) {
            Game.addMessage("=== GAME OVER ===", 'danger');
            Game.addMessage(message, 'danger');
            Game.addMessage(`You survived ${Game.turn} turns and reached level ${Game.currentLevel}.`, 'info');
            document.removeEventListener('keydown', Game.handleKeyPress);
        };

        // ===== INITIALIZATION =====
        Game.init = function() {
            // Setup welcome screen
            const nameInput = document.getElementById('player-name-input');
            const startBtn = document.getElementById('start-game-btn');
            
            nameInput.focus();
            
            // Handle Enter key on name input
            nameInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    Game.startGame();
                }
            });
            
            startBtn.addEventListener('click', Game.startGame);
        };

        Game.startGame = function() {
            const nameInput = document.getElementById('player-name-input');
            const playerName = nameInput.value.trim() || 'Hero';
            
            // Hide welcome, show game
            document.getElementById('welcome-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            
            // Get display element
            Game.display = document.getElementById('game-display');
            
            // Create player
            Game.player = new Player(playerName);
            
            // Generate first dungeon
            Game.dungeon = generateDungeon(Game.config.mapWidth, Game.config.mapHeight);
            
            // Setup input
            document.addEventListener('keydown', Game.handleKeyPress);
            
            // Initial messages
            Game.addMessage(`Welcome, ${playerName}, to the Philosopher's Quest!`, 'success');
            Game.addMessage("Knowledge is power. Every action requires learning.", 'info');
            Game.addMessage("Press ? for help.", 'info');
            
            // Initial render
            render();
        };

        // Start when page loads
        window.addEventListener('load', Game.init);
    </script>
</body>
</html>